## IOS-AI描述词-首页(仿抖音)

## 一、全局 UI 与系统行为

1. **沉浸式 App**
   - 状态栏透明
   - 状态栏内容（时间、电量、信号）悬浮显示
   - 不占用布局高度
   - 内容区域可延伸到状态栏、刘海 / 灵动岛下方
2. **整体布局结构**
   - 根视图为纵向结构（等价 Flex 布局）
   - 底部固定 `TabBar`
   - `ContentView` 内容区域：
     - 除 TabBar 外，占据剩余全部高度（`flexGrow = 1`）
     - 内容可透过状态栏显示

------

## 二、底部 TabBar

1. 固定在底部
2. 切换内容区域页面：
   - 首页 → `Home`
   - 图集 → `Album`
3. 切换 Tab 时：
   - 当前视频播放状态回收
   - 返回后重新进入默认播放状态

------

## 三、Home 页面（核心页面）

### 3.1 顶部标签栏（TopTabBar）

#### 结构

- 左侧：搜索图标
- 中间：标签（`同城 / 关注 / 推荐`）
  - 标签数：3
  - 默认选中：**推荐**
  - 标签间距：30
- 右侧：加号图标

#### 布局

- 浮动在视频区域之上
- 位于 **安全区域下方**
- 不占用内容高度
- 背景：透明（无背景色）

#### 交互

- 支持点击切换
- 支持左右滑动切换
- 标签切换规则：
  1. 页面视图 **不重新创建**
  2. API **只在首次进入该标签时请求 1 次**
  3. 再次切回同一标签不重新请求
  4. 页面状态（滚动、播放）保持

------

### 3.2 标签与页面映射

目录结构固定：

```
ContentView
└── Home
    ├── page
    │   ├── City.swift
    │   ├── Focus.swift
    │   └── Recommend.swift
    ├── view
    └── viewmodel
```

- 同城 → `City.swift`
- 关注 → `Focus.swift`
- 推荐 → `Recommend.swift`

所有页面：

- 遵循 **MVVM**
- View / ViewModel 分离

------

## 四、标签页面通用布局（仿抖音）

每个标签页面结构完全一致：

1. 页面包含：
   - 全屏可上下滑动的视频组件
   - 右侧操作栏
   - 底部视频信息栏
2. 页面数量：
   - 等于 `VideoData.data` 数组大小
3. 数据来源：
   - 当前索引对应的 `VideoInfo`
   - 视频 / 操作栏 / 底部信息全部绑定该对象

------

## 五、视频组件与翻页规则（核心）

### 5.1 页面与滑动

- 单个视频 = 一个完整页面
- 页面高度 = 当前标签页高度
- 上下滑动分页：
  - 一次滑动 **只能切换 1 个视频**
  - 禁止连续快速跨页
  - 当前视频 **完全滑出后** 才进入下一页

### 5.2 翻页行为

- 向上滑 → 上一个视频
- 向下滑 → 下一个视频
- 视频 + 右侧操作栏 + 底部信息 **整体同步切换**

### 5.3 性能优化

- 使用 `LazyVStack`（或等效方案）
- 仅渲染当前可见视频
- 不可见视频释放播放器资源

### 5.4 手势处理

- 监听滑动结束事件
- 滑动完成后：
  - 新视频自动播放
  - 上一个视频暂停并回收状态

------

## 六、视频播放逻辑（严格规则）

### 6.1 播放生命周期

1. 进入 App：
   - 当前视频自动播放
2. 视频切换：
   - 新视频默认自动播放
   - 上一个视频状态回收

### 6.2 加载 / 卡顿

- 视频加载中：显示 loading
- 播放中卡顿：显示 loading
- 缓存完成：自动继续播放，loading 消失

### 6.3 播放 / 暂停交互

- 点击视频中间区域：
  - 暂停播放
  - 显示播放按钮
- 再次点击：
  - 继续播放
  - 播放按钮消失

**限制规则**

- 播放 / 暂停按钮默认隐藏
- 视频上下滑动时不显示按钮
- 播放状态 **只作用于当前视频**

### 6.4 循环与隔离

- 视频播放完成后：
  - 从头开始播放
  - 无限循环
- 播放暂停状态：
  - 不跨视频
  - 不跨页面
  - 不跨标签

------

## 七、视频地址规则

- 视频完整地址：

```
https://api.apiopen.top/api/files/{VideoInfo.fileName}
```

------

## 八、右侧操作栏（精确）

### 8.1 位置

- 页面右下角
- 距右侧：10
- 距底部：20
- 子项垂直排列，间距：10

### 8.2 顺序

1. 用户头像 + 关注
2. 点赞
3. 评论
4. 收藏
5. 分享
6. 唱片

------

### 8.3 用户头像 + 关注

- 头像：
  - `VideoInfo.uploader.avatar`
  - 为空使用默认头像
- 关注图标：
  - 位于头像下方
  - 默认未关注：显示「+」
  - 点击：
    - `+` → `✓`
  - 再次点击：
    - `✓` → `+`
  - 图标不消失，仅切换符号

------

### 8.4 点赞 / 评论 / 收藏 / 分享

- 点赞：
  - `likesCont`（1~10000 随机）
  - 支持点赞 / 取消
- 评论：
  - `commentsCont`（1~10000 随机）
- 收藏：
  - `collectCont`（1~10000 随机）
- 分享：
  - `sharesCont`（1~10000 随机）

------

### 8.5 唱片动画

- 顺时针旋转
- 匀速
- 无限循环

------

## 九、底部视频信息栏

### 位置

- 页面底部
- 与右侧操作栏底部对齐
- 距底部：20

### 内容（纵向排列，左对齐）

1. `@用户名`
   - `VideoInfo.uploader.nickname`
2. 视频标题
   - `VideoInfo.originalName`
   - 去掉 `.mp4`
3. 作者声明

```
📢 作者声明：内容来源于网络
```

------

## 十、接口与分页

### 10.1 视频接口

- 接口：`api/videos`
- ViewModel 中调用
- 使用 `APIService`

### 10.2 参数

- `page = 1`
- `size = 5`

### 10.3 数据处理

- 返回后 append 到 `videos`
- 在 Model 中生成：
  - `likesCont`
  - `commentsCont`
  - `sharesCont`
  - `collectCont`
     （均为 1~10000 随机）

### 10.4 分页规则

- 滑动到最后一个视频：
  - 若 `videos.count >= VideoData.total`
    - 显示「没有更多视频了」
  - 否则：
    - `page + 1`
    - 请求下一页
    - 追加数据
    - 继续滑动

------

## 十一、工程与运行环境

- 使用 **Swift + SwiftUI**
- 视频播放：`AVPlayer`
- 第三方依赖使用 **Podfile**
- 模拟器：**iPhone 17**